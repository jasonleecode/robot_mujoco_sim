# Spot机器人参数集成说明

## 已完成的工作

### 1. Spot机器人参数提取

从 `model/boston_dynamics_spot/spot.xml` 提取了Spot机器人的实际参数，保存在 `src/spot_robot_params.h` 中：

- **身体尺寸**：
  - LEN_BASE = 0.5957米（前后方向）
  - WIDTH_BASE = 0.11米（左右方向）

- **腿的尺寸**：
  - LEN_HIP = 0.055米（从body中心到hip的Y方向距离）
  - LEN_THIGH = 0.32米（大腿长度）
  - LEN_CALF = 0.3365米（小腿长度）

- **标准站立位置**：
  - HX = 0.0弧度
  - HY = 1.04弧度
  - KN = -1.8弧度

- **关节角度范围**：
  - HX: -0.785398 到 0.785398（±45度）
  - HY: -0.898845 到 2.29511（约-51.5度到131.5度）
  - KN: -2.7929 到 -0.254402（约-160度到-14.6度）

### 2. 使用实际机器人状态进行步态调整

在 `getJointTargets()` 方法中，现在使用实际机器人状态（从RobotState获取的当前关节角度）作为逆运动学计算的起点，而不是固定的标准站立位置。

**改进点**：
- 使用 `current_state_.qpos` 获取当前实际关节角度
- 基于当前实际角度计算下一步的关节角度
- 使得步态规划能够适应机器人的实际状态

### 3. 代码修改

- `src/planner.cpp`：使用Spot参数常量，并在逆运动学计算中使用实际机器人状态
- `src/planner.h`：添加了 `setCurrentState()` 方法（可选，当前通过update自动设置）
- `src/spot_robot_params.h`：新增文件，包含Spot机器人的所有参数定义

## 当前限制

### Planner模块参数限制

planner模块的Robot类使用硬编码的宏定义参数：
- `LEN_BASE = 0.3868`（Go2参数）
- `LEN_HIP = 0.0955`（Go2参数）
- `LEN_THIGH = 0.2130`（Go2参数）
- `LEN_CALF = 0.23`（Go2参数）

这些参数在 `planner/include/Quadruped/Joint.h` 中定义，无法在运行时修改。

**影响**：
- planner模块的运动学模型使用的是Go2的参数，不是Spot的参数
- 这可能导致运动学计算的轻微偏差
- 但由于使用了实际机器人状态进行步态调整，影响被部分抵消

## 进一步改进方案

如果要完全使用Spot机器人的参数，有以下方案：

### 方案1：修改planner模块的宏定义（不推荐）

直接修改 `planner/include/Quadruped/Joint.h` 中的宏定义：
```cpp
#define LEN_BASE 0.5957   // Spot参数
#define LEN_HIP 0.055
#define LEN_THIGH 0.32
#define LEN_CALF 0.3365
```

**缺点**：会影响所有使用planner模块的代码

### 方案2：创建Spot专用的Robot类（推荐）

创建一个继承或封装Robot类的SpotRobot类，使用Spot参数：
- 需要修改planner模块的代码结构
- 更灵活，但需要更多工作

### 方案3：使用MuJoCo的运动学模型

直接使用MuJoCo模型进行运动学计算，绕过planner模块的Robot类：
- 最准确
- 但需要重新实现运动学计算

## 当前实现的优势

虽然planner模块使用Go2参数，但当前实现仍有优势：

1. **使用实际状态**：基于实际机器人状态计算，能够适应实际运动
2. **逆运动学求解**：使用planner模块的逆运动学算法，计算精确
3. **关节限制**：自动应用关节限制
4. **模块化**：保持planner模块的独立性

## 测试建议

1. **步态测试**：测试前进、转向等基本步态
2. **参数调整**：根据实际效果调整步幅、抬腿高度等参数
3. **稳定性测试**：观察机器人运动是否稳定

## 参数对照表

| 参数 | Go2 (planner模块) | Spot (实际) | 差异 |
|------|-------------------|-------------|------|
| LEN_BASE | 0.3868 | 0.5957 | +54% |
| LEN_HIP | 0.0955 | 0.055 | -42% |
| LEN_THIGH | 0.2130 | 0.32 | +50% |
| LEN_CALF | 0.23 | 0.3365 | +46% |

由于参数差异较大，建议在后续版本中实现方案2或方案3，以使用准确的Spot参数。

